<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Avalon Firmware: supercap_control_manager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Avalon Firmware
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classsupercap__control__manager.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle"><div class="title">supercap_control_manager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Main control class for managing the supercapacitor charge/discharge behavior.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="supercap__controllers_8hpp_source.html">supercap_controllers.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for supercap_control_manager:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classsupercap__control__manager.png" usemap="#supercap_5Fcontrol_5Fmanager_map" alt=""/>
  <map id="supercap_5Fcontrol_5Fmanager_map" name="supercap_5Fcontrol_5Fmanager_map">
<area href="classadc__manager.html" title="Class to manage ADC hardware sampling and filtering." alt="adc_manager" shape="rect" coords="0,0,167,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9c6a56dec2098d79af654c8e2b03fbde" id="r_a9c6a56dec2098d79af654c8e2b03fbde"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9c6a56dec2098d79af654c8e2b03fbde">supercap_control_manager</a> (ADC_HandleTypeDef *adc_cap, ADC_HandleTypeDef *adc_bat, ADC_HandleTypeDef *adc_temp)</td></tr>
<tr class="memdesc:a9c6a56dec2098d79af654c8e2b03fbde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor for the supercap controller.  <br /></td></tr>
<tr class="separator:a9c6a56dec2098d79af654c8e2b03fbde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad23eb2bbe99fb0f6b281a1eea871e5c8" id="r_ad23eb2bbe99fb0f6b281a1eea871e5c8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad23eb2bbe99fb0f6b281a1eea871e5c8">~supercap_control_manager</a> ()</td></tr>
<tr class="memdesc:ad23eb2bbe99fb0f6b281a1eea871e5c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor (default)  <br /></td></tr>
<tr class="separator:ad23eb2bbe99fb0f6b281a1eea871e5c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a938dd82a5e912e79b3838c4b0d3879bb" id="r_a938dd82a5e912e79b3838c4b0d3879bb"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a938dd82a5e912e79b3838c4b0d3879bb">init_loop</a> ()</td></tr>
<tr class="memdesc:a938dd82a5e912e79b3838c4b0d3879bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the control loop by setting up the PID controllers.  <br /></td></tr>
<tr class="separator:a938dd82a5e912e79b3838c4b0d3879bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed93c989e0784f9363a064fde4d3f32e" id="r_aed93c989e0784f9363a064fde4d3f32e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed93c989e0784f9363a064fde4d3f32e">setup_pid_controllers</a> ()</td></tr>
<tr class="memdesc:aed93c989e0784f9363a064fde4d3f32e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures PID controllers for power, current, and voltage regulation.  <br /></td></tr>
<tr class="separator:aed93c989e0784f9363a064fde4d3f32e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3232216531c15765c269f70ca738edd6" id="r_a3232216531c15765c269f70ca738edd6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3232216531c15765c269f70ca738edd6">set_ref_chassis_power</a> (float ref_power_)</td></tr>
<tr class="memdesc:a3232216531c15765c269f70ca738edd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the desired reference power draw (in watts) for the chassis.  <br /></td></tr>
<tr class="separator:a3232216531c15765c269f70ca738edd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8b57a0cc60b8915157f6ed261372cb" id="r_a4c8b57a0cc60b8915157f6ed261372cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c8b57a0cc60b8915157f6ed261372cb">loop_update</a> (float Icap_, float Ibat_, float Vcap_, float Ichassis_, float Vbat_)</td></tr>
<tr class="memdesc:a4c8b57a0cc60b8915157f6ed261372cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a full control loop update using current sensor inputs.  <br /></td></tr>
<tr class="separator:a4c8b57a0cc60b8915157f6ed261372cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50bdf5a8e41d2a23738aff8da8fde391" id="r_a50bdf5a8e41d2a23738aff8da8fde391"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a50bdf5a8e41d2a23738aff8da8fde391">stop_loop</a> ()</td></tr>
<tr class="memdesc:a50bdf5a8e41d2a23738aff8da8fde391"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the control loop and disables gate driving.  <br /></td></tr>
<tr class="separator:a50bdf5a8e41d2a23738aff8da8fde391"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6abb1fd969adbba14b518da8ec0830ae" id="r_a6abb1fd969adbba14b518da8ec0830ae"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6abb1fd969adbba14b518da8ec0830ae">start_loop</a> ()</td></tr>
<tr class="memdesc:a6abb1fd969adbba14b518da8ec0830ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the supercap control loop (if not in calibration mode).  <br /></td></tr>
<tr class="separator:a6abb1fd969adbba14b518da8ec0830ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a532f7603af350d8fc079adee14d8ff71" id="r_a532f7603af350d8fc079adee14d8ff71"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a532f7603af350d8fc079adee14d8ff71">start_gates_pwm</a> (float init_duty_cycle)</td></tr>
<tr class="memdesc:a532f7603af350d8fc079adee14d8ff71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the gate PWM output using a given starting duty cycle.  <br /></td></tr>
<tr class="separator:a532f7603af350d8fc079adee14d8ff71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfe7a6aec1ede157ea85260871aa6239" id="r_acfe7a6aec1ede157ea85260871aa6239"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acfe7a6aec1ede157ea85260871aa6239">all_safety_checks</a> ()</td></tr>
<tr class="memdesc:acfe7a6aec1ede157ea85260871aa6239"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes all defined safety checks (voltage, current).  <br /></td></tr>
<tr class="separator:acfe7a6aec1ede157ea85260871aa6239"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5922bcb0490963cd9c812f0fd742f9" id="r_ada5922bcb0490963cd9c812f0fd742f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada5922bcb0490963cd9c812f0fd742f9">silent_mode</a> ()</td></tr>
<tr class="memdesc:ada5922bcb0490963cd9c812f0fd742f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manually forces system into a silent mode (e.g., for emergency recovery).  <br /></td></tr>
<tr class="separator:ada5922bcb0490963cd9c812f0fd742f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classadc__manager"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pub_methods_classadc__manager')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classadc__manager.html">adc_manager</a></td></tr>
<tr class="memitem:a1a88da33daa8bbdd601bdb9d0dc7791f inherit pub_methods_classadc__manager" id="r_a1a88da33daa8bbdd601bdb9d0dc7791f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classadc__manager.html#a1a88da33daa8bbdd601bdb9d0dc7791f">adc_manager</a> (ADC_HandleTypeDef *adc_cap, ADC_HandleTypeDef *adc_bat, ADC_HandleTypeDef *adc_temp)</td></tr>
<tr class="memdesc:a1a88da33daa8bbdd601bdb9d0dc7791f inherit pub_methods_classadc__manager"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <br /></td></tr>
<tr class="separator:a1a88da33daa8bbdd601bdb9d0dc7791f inherit pub_methods_classadc__manager"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0e5b68c23328dbdd8fa687539f484c0 inherit pub_methods_classadc__manager" id="r_aa0e5b68c23328dbdd8fa687539f484c0"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classadc__manager.html#aa0e5b68c23328dbdd8fa687539f484c0">adc_init</a> (uint8_t *filters_length)</td></tr>
<tr class="memdesc:aa0e5b68c23328dbdd8fa687539f484c0 inherit pub_methods_classadc__manager"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes ADCs and filter states.  <br /></td></tr>
<tr class="separator:aa0e5b68c23328dbdd8fa687539f484c0 inherit pub_methods_classadc__manager"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae46d558401cfab485b8ced03624f05e inherit pub_methods_classadc__manager" id="r_aae46d558401cfab485b8ced03624f05e"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classadc__manager.html#aae46d558401cfab485b8ced03624f05e">get_temperature</a> ()</td></tr>
<tr class="memdesc:aae46d558401cfab485b8ced03624f05e inherit pub_methods_classadc__manager"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads temperature using onboard NTC.  <br /></td></tr>
<tr class="separator:aae46d558401cfab485b8ced03624f05e inherit pub_methods_classadc__manager"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a61078cf818a35904e0b949357b6c53ba" id="r_a61078cf818a35904e0b949357b6c53ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="supercap__controllers_8hpp.html#a184125051e5d414b5fc8fe639fa3e92c">safetyLevelDef</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a61078cf818a35904e0b949357b6c53ba">safetyLevel</a></td></tr>
<tr class="memdesc:a61078cf818a35904e0b949357b6c53ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current system safety level status.  <br /></td></tr>
<tr class="separator:a61078cf818a35904e0b949357b6c53ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_attribs_classadc__manager"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pub_attribs_classadc__manager')"><img src="closed.png" alt="-"/>&#160;Data Fields inherited from <a class="el" href="classadc__manager.html">adc_manager</a></td></tr>
<tr class="memitem:a00a4020c7ba022baff1b51fa178b277b inherit pub_attribs_classadc__manager" id="r_a00a4020c7ba022baff1b51fa178b277b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classadc__manager.html#a00a4020c7ba022baff1b51fa178b277b">calibration_ready</a> = false</td></tr>
<tr class="memdesc:a00a4020c7ba022baff1b51fa178b277b inherit pub_attribs_classadc__manager"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optional flag for calibration flow.  <br /></td></tr>
<tr class="separator:a00a4020c7ba022baff1b51fa178b277b inherit pub_attribs_classadc__manager"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main control class for managing the supercapacitor charge/discharge behavior. </p>
<p>Inherits from <code><a class="el" href="classadc__manager.html" title="Class to manage ADC hardware sampling and filtering.">adc_manager</a></code> to reuse ADC data collection logic. This class manages PID-based power balancing, duty cycle generation, and safety enforcement logic. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a9c6a56dec2098d79af654c8e2b03fbde" name="a9c6a56dec2098d79af654c8e2b03fbde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c6a56dec2098d79af654c8e2b03fbde">&#9670;&#160;</a></span>supercap_control_manager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">supercap_control_manager::supercap_control_manager </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>adc_cap</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>adc_bat</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>adc_temp</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor for the supercap controller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">adc_cap</td><td>Pointer to ADC for supercap measurements </td></tr>
    <tr><td class="paramname">adc_bat</td><td>Pointer to ADC for battery-side measurements </td></tr>
    <tr><td class="paramname">adc_temp</td><td>Pointer to ADC used for temperature sensing </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad23eb2bbe99fb0f6b281a1eea871e5c8" name="ad23eb2bbe99fb0f6b281a1eea871e5c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad23eb2bbe99fb0f6b281a1eea871e5c8">&#9670;&#160;</a></span>~supercap_control_manager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">supercap_control_manager::~supercap_control_manager </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor (default) </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="acfe7a6aec1ede157ea85260871aa6239" name="acfe7a6aec1ede157ea85260871aa6239"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfe7a6aec1ede157ea85260871aa6239">&#9670;&#160;</a></span>all_safety_checks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::all_safety_checks </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes all defined safety checks (voltage, current). </p>

</div>
</div>
<a id="a938dd82a5e912e79b3838c4b0d3879bb" name="a938dd82a5e912e79b3838c4b0d3879bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a938dd82a5e912e79b3838c4b0d3879bb">&#9670;&#160;</a></span>init_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef supercap_control_manager::init_loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the control loop by setting up the PID controllers. </p>
<p>Initializes the supercapacitor control loop.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK if setup is successful</dd></dl>
<p>This function is the main entry point for setting up all the PID controllers used in power, current, and voltage regulation of the supercapacitor buck-boost control system. It prepares the system to safely start PWM generation and transitions into active loop mode.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK if initialization was successful. </dd></dl>

</div>
</div>
<a id="a4c8b57a0cc60b8915157f6ed261372cb" name="a4c8b57a0cc60b8915157f6ed261372cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c8b57a0cc60b8915157f6ed261372cb">&#9670;&#160;</a></span>loop_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::loop_update </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Icap_</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Ibat_</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Vcap_</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Ichassis_</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Vbat_</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a full control loop update using current sensor inputs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Icap_</td><td>Current into the supercap </td></tr>
    <tr><td class="paramname">Ibat_</td><td>Current from the battery </td></tr>
    <tr><td class="paramname">Vcap_</td><td>Voltage of the supercap bank </td></tr>
    <tr><td class="paramname">Ichassis_</td><td>Current drawn by the chassis </td></tr>
    <tr><td class="paramname">Vbat_</td><td>Voltage of the battery </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3232216531c15765c269f70ca738edd6" name="a3232216531c15765c269f70ca738edd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3232216531c15765c269f70ca738edd6">&#9670;&#160;</a></span>set_ref_chassis_power()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::set_ref_chassis_power </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>ref_power_</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the desired reference power draw (in watts) for the chassis. </p>
<p>Sets the chassis power reference for the outermost control loop.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ref_power_</td><td>The power target.</td></tr>
  </table>
  </dd>
</dl>
<p>Used by the application layer to define the desired output power level that the control system should regulate around.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ref_power_</td><td>Desired chassis power reference in watts. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aed93c989e0784f9363a064fde4d3f32e" name="aed93c989e0784f9363a064fde4d3f32e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed93c989e0784f9363a064fde4d3f32e">&#9670;&#160;</a></span>setup_pid_controllers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::setup_pid_controllers </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures PID controllers for power, current, and voltage regulation. </p>
<p>Initializes all PID controllers used in the control loop.</p>
<p>This sets up the PID control parameters for:</p><ul>
<li>pid[0]: Battery power control loop (P_bat)</li>
<li>pid[2]: Supercapacitor current control loop (I_capa)</li>
<li>pid[3]: Supercap upper voltage limit clamp (V_cap_max)</li>
<li>pid[4]: Supercap lower voltage limit clamp (V_cap_min)</li>
</ul>
<p>For each loop, the gain parameters and min/max output ranges are set. The controller states are initialized using <code>arm_pid_init_f32</code>, and duty ratio is precomputed based on real-time readings to avoid unstable startup behavior.</p>
<p>If <code>CALIBRATION_MODE</code> is disabled, this also starts the PWM gates using the computed initial duty ratio and marks the system as initialized. </p>

</div>
</div>
<a id="ada5922bcb0490963cd9c812f0fd742f9" name="ada5922bcb0490963cd9c812f0fd742f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada5922bcb0490963cd9c812f0fd742f9">&#9670;&#160;</a></span>silent_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::silent_mode </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Manually forces system into a silent mode (e.g., for emergency recovery). </p>

</div>
</div>
<a id="a532f7603af350d8fc079adee14d8ff71" name="a532f7603af350d8fc079adee14d8ff71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a532f7603af350d8fc079adee14d8ff71">&#9670;&#160;</a></span>start_gates_pwm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef supercap_control_manager::start_gates_pwm </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>init_duty_cycle</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the gate PWM output using a given starting duty cycle. </p>
<p>Starts the high-resolution PWM gate outputs with an initial duty cycle.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">init_duty_cycle</td><td>Duty ratio to apply </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK if successful</dd></dl>
<p>This function is typically called after PID controllers are initialized. It updates the gate PWM duty cycle and starts all 4 gate signals using the STM32 HRTIM peripheral.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">init_duty_cycle</td><td>The duty cycle to start with, based on Vcap / Vbat ratio. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK if HRTIM started successfully. </dd></dl>

</div>
</div>
<a id="a6abb1fd969adbba14b518da8ec0830ae" name="a6abb1fd969adbba14b518da8ec0830ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6abb1fd969adbba14b518da8ec0830ae">&#9670;&#160;</a></span>start_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef supercap_control_manager::start_loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts the supercap control loop (if not in calibration mode). </p>
<p>Starts the control loop by re-enabling PWM gates and computing the initial duty ratio.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success, HAL_ERROR otherwise</dd></dl>
<p>Only runs if not in calibration mode. Reads current capacitor and battery voltages to estimate a stable initial duty cycle for the buck-boost circuit, then starts gate switching.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK if started successfully, HAL_ERROR otherwise. </dd></dl>

</div>
</div>
<a id="a50bdf5a8e41d2a23738aff8da8fde391" name="a50bdf5a8e41d2a23738aff8da8fde391"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50bdf5a8e41d2a23738aff8da8fde391">&#9670;&#160;</a></span>stop_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void supercap_control_manager::stop_loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops the control loop and disables gate driving. </p>
<p>Halts the control loop and disables PWM gate signals.</p>
<p>This is the object method version. Sets loop flags to false and stops PWM via <code>stop_gates_pwm</code>. </p>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a61078cf818a35904e0b949357b6c53ba" name="a61078cf818a35904e0b949357b6c53ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61078cf818a35904e0b949357b6c53ba">&#9670;&#160;</a></span>safetyLevel</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="supercap__controllers_8hpp.html#a184125051e5d414b5fc8fe639fa3e92c">safetyLevelDef</a> supercap_control_manager::safetyLevel</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current system safety level status. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>System/stm_utils/Inc/<a class="el" href="supercap__controllers_8hpp_source.html">supercap_controllers.hpp</a></li>
<li>System/stm_utils/Src/<a class="el" href="supercap__controllers_8cpp.html">supercap_controllers.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classsupercap__control__manager.html">supercap_control_manager</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
